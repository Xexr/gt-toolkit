# Multimodal Spec Review Formula
#
# Multi-LLM review of validated specs for gaps, inconsistencies, and codebase mismatches.
# Runs all 3 models (Opus, GPT, Gemini) in parallel with all review categories.
#
# Usage:
#   gt sling spec-multimodal-review dypt/crew/neo \
#     --var feature="command-palette"

description = """
Multi-LLM spec review using 3 models in parallel to catch gaps and inconsistencies.

Autonomous version of review-documentation skill:
- All 3 models always (Opus 4.6, GPT 5.3 Codex, Gemini 3 Pro)
- All review categories always (no configuration)
- Skips CLI preflight checks (assumes they work)
- Reuses existing context.md if available from step 0

This is part of the design-to-implementation pipeline (step 3).

## Step Lifecycle (Molecule Work Loop)

This formula runs as a molecule — each step is a wisp bead. Use the
standard molecule work loop to advance through steps:

```bash
# 1. Find your current step:
bd mol current <molecule-id>

# 2. Execute the step (follow its instructions)

# 3. Close the step when done:
bd close <step-id>

# 4. Find the next step:
bd mol current <molecule-id>

# 5. Repeat until molecule complete
```

`bd mol current` returns the next ready step (open + all blocking deps
closed). Closing a step unblocks the next one in the dependency chain.

**Crash recovery:** Each `bd close` is durable. If your session crashes,
the next session runs `gt prime` which detects the molecule on your hook
and shows progress. `bd mol current` picks up at the next unclosed step.

Do NOT batch-close all steps at the end — close each one as you finish it.
"""
formula = "spec-multimodal-review"
type = "workflow"
version = 3

[vars]
[vars.feature]
description = "Feature name (used for input/output paths)"
required = true

# Placeholder step that will be expanded
[[steps]]
id = "review"
title = "Run multimodal review process"
description = "This step is expanded into the full 3-model review workflow."

# Composition: expand the placeholder with the expansion formula
[compose]

[[compose.expand]]
target = "review"
with = "spec-multimodal-review-expansion"
